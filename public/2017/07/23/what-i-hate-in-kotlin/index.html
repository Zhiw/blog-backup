<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>【译】Kotlin 中我讨厌什么 | Zhiw</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Kotlin," />
  

  <meta name="description" content="原文地址：What do I hate in Kotlin
原文作者：Moskala Marcin
译文出自：掘金翻译计划
译者：Zhiw
校对者：stormrabbit,yazhi1992


我爱 Kotlin。这是我学习过最棒的语言，并且这两年多的时间，我很享受用它来写应用。尽管如此，就像最好的老婚姻一样，我有一大堆讨厌的东西并且我知道大多数不会改变。它们大多数也不算大问题，也不容易让人陷入">
<meta property="og:type" content="article">
<meta property="og:title" content="【译】Kotlin 中我讨厌什么">
<meta property="og:url" content="http://yuzhiw.com/2017/07/23/what-i-hate-in-kotlin/index.html">
<meta property="og:site_name" content="Zhiw">
<meta property="og:description" content="原文地址：What do I hate in Kotlin
原文作者：Moskala Marcin
译文出自：掘金翻译计划
译者：Zhiw
校对者：stormrabbit,yazhi1992


我爱 Kotlin。这是我学习过最棒的语言，并且这两年多的时间，我很享受用它来写应用。尽管如此，就像最好的老婚姻一样，我有一大堆讨厌的东西并且我知道大多数不会改变。它们大多数也不算大问题，也不容易让人陷入">
<meta property="og:updated_time" content="2017-07-23T06:20:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【译】Kotlin 中我讨厌什么">
<meta name="twitter:description" content="原文地址：What do I hate in Kotlin
原文作者：Moskala Marcin
译文出自：掘金翻译计划
译者：Zhiw
校对者：stormrabbit,yazhi1992


我爱 Kotlin。这是我学习过最棒的语言，并且这两年多的时间，我很享受用它来写应用。尽管如此，就像最好的老婚姻一样，我有一大堆讨厌的东西并且我知道大多数不会改变。它们大多数也不算大问题，也不容易让人陷入">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-77757943-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?288b0ec4a4935e5a70a2a1e7475509e9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-的流毒"><span class="toc-text">Java 的流毒</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#减号运算符问题和其他不明确的操作结果"><span class="toc-text">减号运算符问题和其他不明确的操作结果</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#孤立主义"><span class="toc-text">孤立主义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#元组-VS-单一抽象方法"><span class="toc-text">元组 VS 单一抽象方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-what-i-hate-in-kotlin" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">【译】Kotlin 中我讨厌什么</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.07.23</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Yu Zhiwei</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <blockquote>
<ul>
<li>原文地址：<a href="http://marcinmoskala.com/kotlin/2017/05/31/what-i-hate-in-kotlin.html" target="_blank" rel="external">What do I hate in Kotlin</a></li>
<li>原文作者：<a href="http://marcinmoskala.com/" target="_blank" rel="external">Moskala Marcin</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">掘金翻译计划</a></li>
<li>译者：<a href="https://github.com/Zhiw" target="_blank" rel="external">Zhiw</a></li>
<li>校对者：<a href="https://github.com/stormrabbit" target="_blank" rel="external">stormrabbit</a>,<a href="https://github.com/yazhi1992" target="_blank" rel="external">yazhi1992</a></li>
</ul>
</blockquote>
<p>我爱 Kotlin。这是我学习过最棒的语言，并且这两年多的时间，我很享受用它来写应用。尽管如此，就像最好的老婚姻一样，我有一大堆讨厌的东西并且我知道大多数不会改变。它们大多数也不算大问题，也不容易让人陷入困境。不过，它们一直存在，是 Kotlin 美中不足之处。</p>
<h1 id="Java-的流毒"><a href="#Java-的流毒" class="headerlink" title="Java 的流毒"></a>Java 的流毒</h1><p>在 Kotlin 中，你不能定义这两个函数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fun foo(strings: List&#60;String&#62;) &#123;&#125;&#10;fun foo(ints: List&#60;Int&#62;) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>这是因为他们两个都有相同的 JVM 签名。这不是 Kotlin 的问题，而是将他们编译成 Java 字节码的结果。这只是 Java 的流毒影响 Kotlin 执行的一种方式。但是这里还有更大的问题。例如，<a href="https://kotlinlang.org/docs/reference/extensions.html#extensions-are-resolved-statically" target="_blank" rel="external">拓展是静态解析</a>。这是一个大问题，我希望写一整篇文章来单独讨论这个问题。现在，它仅仅是个问题而且不直观。事实上，它就是这样设计的，因为这样拓展函数被简单地编译为一个接受第一个参数的静态函数。现在需要在 Kotlin/JavaScript 和 Kotlin/Native 中以相同的方式实现。可以，这很 Java。</p>
<h1 id="减号运算符问题和其他不明确的操作结果"><a href="#减号运算符问题和其他不明确的操作结果" class="headerlink" title="减号运算符问题和其他不明确的操作结果"></a>减号运算符问题和其他不明确的操作结果</h1><p>让我们来看一下这个操作：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">println(listOf(2,2,2) - 2) // [2, 2]</span><br></pre></td></tr></table></figure>
<p>结果是很直观的，我们从 list 中移除了该元素，因此我们得到一个没有该元素的 list。现在让我们来看一下这个表达式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">println(listOf(2,2,2) - listOf(2))</span><br></pre></td></tr></table></figure>
<p>结果是什么？空的 list！非常不直观，并且我 <a href="https://youtrack.jetbrains.com/issue/KT-11453" target="_blank" rel="external">一年前报告了该问题</a>。但是得到的回复是“它就是这么设计的”。是的，函数说明如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/*&#10;// &#21435;&#38500;&#32473;&#23450;&#30340;&#38598;&#21512;&#20013;&#25152;&#21253;&#21547;&#30340;&#20803;&#32032;&#21518;&#65292;&#36820;&#22238;&#21407;&#38598;&#21512;&#12290;&#10;*/</span><br></pre></td></tr></table></figure>
<p>但是这并没有提高程序的可读性。这还只是不直观的一个例子。让我们来看一些更不直观的结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#34;1&#34;.toInt() // 1 - parsed to number&#10;&#39;1&#39;.toInt() // 49 - its ASCII code</span><br></pre></td></tr></table></figure>
<p>这是正确的，但同时奇怪的是，请注意以下表达式的结果是 true。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#34;1&#34;.toInt() != &#39;1&#39;.toInt()&#10;&#34;1&#34;.toInt() != &#34;1&#34;[0].toInt()</span><br></pre></td></tr></table></figure>
<p>虽然 <code>String</code> 中任何非数字的字符都会导致 <code>NumberFormatException</code>，但对于返回 null 的 String 也有 <code>toIntOrNull</code> 函数。我认为这个函数首先应该命名为另外一种方式更好，或许是 <code>parseInt</code>?</p>
<p>让我们看一下另外一件事情，但这个更为复杂：（感谢 <a href="https://github.com/mg6maciej" target="_blank" rel="external">Maciej Górski</a> 的展示）。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.inc() // 2&#10;1.dec() // 0&#10;-1.inc() // -2&#10;-1.dec() // 0</span><br></pre></td></tr></table></figure>
<p>后面两个结果很奇怪，难道不是吗？原因是 <code>-</code> 不是数字的一部分，而是 Int 的一元拓展函数。这就是为什么后面两行和下面的是相同的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.inc().unaryMinus()&#10;1.dec().unaryMinus()</span><br></pre></td></tr></table></figure>
<p>这也是这么设计的，并且这也不会改变。另外一些人会讨论这该如何如何。让我们假设在 Int 后面加了空格：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- 1.inc() // -2&#10;- 1.dec() // 0</span><br></pre></td></tr></table></figure>
<p>现在这看起来就合理了。这应该怎么使用呢？数字应该和 <code>-</code> 一起在括号里面。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(-1).inc() // 0&#10;(-1).dec() // -2</span><br></pre></td></tr></table></figure>
<p>从理性的角度来看，这没问题，但是我认为每个人都会觉得 <code>-2</code> 应该是一个数字，而不是 <code>2.unaryMinus()</code>。</p>
<h1 id="孤立主义"><a href="#孤立主义" class="headerlink" title="孤立主义"></a>孤立主义</h1><p>Kotlin 有很多适用于任何对象的拓展（比如 let, apply, run, also, to, takeIf, …），我看到很多具有创造力的用法。在 Kotlin 中，你可以将以下定义：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">val list = if(student != null) &#123;&#10;    getListForStudent(student)&#10;&#125; else &#123;&#10;    getStandardList()&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>替换为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">val list = student?.let &#123; getListForStudent(student) &#125; ?: getStandardList()</span><br></pre></td></tr></table></figure>
<p>这样代码更少而且看起来更棒。另外，当添加其他条件时，我们依然可以使用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">val list = student?.takeIf &#123; it.passing &#125;?.let &#123; getListForStudent(student) &#125; ?: getStandardList()</span><br></pre></td></tr></table></figure>
<p>但是这个真的比以前简单的 if 条件更好吗？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">val list = if(student != null &#38;&#38; student.passing) &#123;&#10;    getListForStudent(student)&#10;&#125; else &#123;&#10;    getStandardList()&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>我不置可否，但事实上，这种刻意使用 Kotlin 拓展实现的代码，对于没有使用过 Kotlin 的开发者来说是非常晦涩和抽象的。这种特性让 Kotlin 对于初学者来说变得很困难。Kotlin 的协程变化很大，这是一个很棒的特性。当我开始学习它的时候，我一整天都在重复“不可思议”和“哇”。Kotlin 协程（Coroutines）让多线程操作变得如此简单，非常棒。我觉得编程一开始就应该这么设计。不过，搞清楚 Kotlin 协程依然是一件很复杂的事情，并且它与其它技术的实现方式相去甚远。如果社区开始广泛使用协程，这又会是其它语言的开发者入门的另一个障碍。这就导致了孤立。并且我觉得这太早了。现在 Kotlin 在 Android 和 Web 方面变得越来越受欢迎，而且它刚刚开始在 JavaScript 和 native 中使用。我认为这种多样化对 Kotlin 来说愈发重要，并且 Kotlin 的具体功能介绍应该稍后开始。现在，Kotlin\JavaScript 和 Kotlin\Native 依然有很多工作要做。</p>
<h1 id="元组-VS-单一抽象方法"><a href="#元组-VS-单一抽象方法" class="headerlink" title="元组 VS 单一抽象方法"></a>元组 VS 单一抽象方法</h1><p><a href="https://blog.jetbrains.com/kotlin/migrating-tuples/" target="_blank" rel="external">Kotlin 放弃了元组</a>，并且只留下 <code>Pair</code> 和 <code>Triple</code>。因为应该使用数据类（date class）代替元组。这有什么不同呢？数据类包含其命名，以及其所有的属性的命名。除此之外，它可以像元组一样使用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data class Student(&#10;        val name: String,&#10;        val surname: String,&#10;        val passing: Boolean,&#10;        val grade: Double&#10;)&#10;&#10;val (name, surname, passing, grade) = getSomeStudent()</span><br></pre></td></tr></table></figure>
<p>同时，Kotlin 通过生成包含 lambda 方法而不是 Java 单一抽象方法（SAM:Simple Abstract Method）的 lambda 构造函数和方法来添加对 Java 单一抽象方法的支持：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view.setOnClickListener &#123; toast(&#34;Foo&#34;) &#125;</span><br></pre></td></tr></table></figure>
<p>但是在 Kotlin 中定义的单一抽象方法不起作用，因为它建议使用函数类型。单一抽象方法和函数类型有什么不同呢？单一抽象方法包含名称，并且其所有参数的命名。从 Kotlin 1.1 开始，函数类型可以通过 typealias（类型别名）实现：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">typealias OnClick = (view: View)-&#62;Unit</span><br></pre></td></tr></table></figure>
<p>但我仍然觉得这缺乏对称性。如果强烈建议使用数据类，并禁止元组，那么为什么建议使用函数类型而不是单一抽象方法，并且 Kotlin 不支持单一抽象方法。可能的答案是元组会在现实生活的项目产生更多的问题。JetBrains 有很多关于语言用法的数据，他们知道如何分析它。他们非常了解 lambda 语言特性如何影响开发，并且我猜他们知道他们在做什么。我只是基于我的直觉，如果程序员可以决定是否要使用元组或数据类，那将会更好。而且这样显得不孤立，因为大多数现代语言都引入了元组。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>事实上，这只是一些小事情。与 JavaScript，PHP 或 Ruby 中存在的问题相比根本不算什么。Kotlin 从一开始就精心设计，是很多问题的解决方案。只有一些小东西不够好。<br>至少这几年，Kotlin 仍然是，也将是，我最喜欢的语言。</p>
<hr>
<blockquote>
<p><a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">掘金翻译计划</a> 是一个翻译优质互联网技术文章的社区，文章来源为 <a href="https://juejin.im" target="_blank" rel="external">掘金</a> 上的英文分享文章。内容覆盖 <a href="https://github.com/xitu/gold-miner#android" target="_blank" rel="external">Android</a>、<a href="https://github.com/xitu/gold-miner#ios" target="_blank" rel="external">iOS</a>、<a href="https://github.com/xitu/gold-miner#react" target="_blank" rel="external">React</a>、<a href="https://github.com/xitu/gold-miner#前端" target="_blank" rel="external">前端</a>、<a href="https://github.com/xitu/gold-miner#后端" target="_blank" rel="external">后端</a>、<a href="https://github.com/xitu/gold-miner#产品" target="_blank" rel="external">产品</a>、<a href="https://github.com/xitu/gold-miner#设计" target="_blank" rel="external">设计</a> 等领域，想要查看更多优质译文请持续关注 <a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">掘金翻译计划</a>。</p>
</blockquote>

    
  </div>
</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017/02/22/Observer-Pattern-–-Reactive-Programming/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="hide pull-right" href="/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
